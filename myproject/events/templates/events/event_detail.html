{% extends 'base.html' %}

{% block title %}{{ event.title }} - EventManager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <!-- Event Image -->
        {% if event.image %}
            <img src="{{ event.image.url }}" alt="{{ event.title }}" class="img-fluid rounded-3 mb-4 w-100" style="max-height:400px;object-fit:cover;">
        {% else %}
            <div class="bg-secondary rounded-3 mb-4 d-flex align-items-center justify-content-center" style="height:300px;">
                <i class="bi bi-calendar-event text-white" style="font-size:5rem;"></i>
            </div>
        {% endif %}

        <!-- Event Info -->
        <h1>{{ event.title }}</h1>
        <div class="mb-3">
            <span class="badge bg-primary">{{ event.category.name }}</span>
            {% if event.average_rating > 0 %}
            <span class="star-rating ms-2">
                {% for i in "12345" %}
                    {% if forloop.counter <= event.average_rating %}
                        <i class="bi bi-star-fill"></i>
                    {% else %}
                        <i class="bi bi-star"></i>
                    {% endif %}
                {% endfor %}
                <span class="text-muted">({{ event.review_count }} reviews)</span>
            </span>
            {% endif %}
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h5>About This Event</h5>
                <p>{{ event.description|linebreaks }}</p>
            </div>
        </div>

        <!-- Reviews Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h5>Reviews & Ratings</h5>
                {% if can_review %}
                <a href="{% url 'events:add_review' event.slug %}" class="btn btn-outline-primary btn-sm mb-3"><i class="bi bi-pencil"></i> Write a Review</a>
                {% endif %}
                {% if reviews %}
                    {% for review in reviews %}
                    <div class="border-bottom pb-3 mb-3">
                        <div class="d-flex justify-content-between">
                            <strong>{{ review.user.get_full_name|default:review.user.username }}</strong>
                            <small class="text-muted">{{ review.created_at|date:"M d, Y" }}</small>
                        </div>
                        <div class="star-rating">
                            {% for i in "12345" %}
                                {% if forloop.counter <= review.rating %}
                                    <i class="bi bi-star-fill"></i>
                                {% else %}
                                    <i class="bi bi-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <p class="mt-2 mb-0">{{ review.comment }}</p>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">No reviews yet. Be the first to review!</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-md-4">
        <div class="card shadow-sm sticky-top" style="top:80px;">
            <div class="card-body">
                <h4 class="text-primary fw-bold">Rs.{{ event.price }} <small class="text-muted fw-normal">/ person</small></h4>
                <hr>
                <p><i class="bi bi-geo-alt text-primary"></i> <strong>Location:</strong> {{ event.location }}</p>
                <p><i class="bi bi-calendar text-primary"></i> <strong>Date:</strong> {{ event.date|date:"F d, Y" }}</p>
                <p><i class="bi bi-clock text-primary"></i> <strong>Time:</strong> {{ event.time|time:"h:i A" }}</p>
                <p><i class="bi bi-people text-primary"></i> <strong>Available Slots:</strong> {{ event.available_slots }}</p>
                <p><i class="bi bi-tag text-primary"></i> <strong>Category:</strong> {{ event.category.name }}</p>
                <hr>
                {% if event.is_past %}
                    <button class="btn btn-secondary w-100" disabled>Event Has Passed</button>
                {% elif event.available_slots <= 0 %}
                    <button class="btn btn-secondary w-100" disabled>Sold Out</button>
                {% else %}
                    <a href="{% url 'events:booking_create' event.slug %}" class="btn btn-book w-100"><i class="bi bi-ticket"></i> Book Now</a>
                {% endif %}

                {% if user.is_staff %}
                <hr>
                <div class="d-grid gap-2">
                    <a href="{% url 'events:event_edit' event.slug %}" class="btn btn-outline-warning btn-sm"><i class="bi bi-pencil"></i> Edit Event</a>
                    <a href="{% url 'events:event_delete' event.slug %}" class="btn btn-outline-danger btn-sm"><i class="bi bi-trash"></i> Delete Event</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}